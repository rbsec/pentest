#!/usr/bin/env python3

# Convert password hashes from ASP.NET Membership provider to john's format
#
# SELECT aspnet_Users.UserName,aspnet_Membership.Password,aspnet_Membership.PasswordSalt
# FROM aspnet_Users,aspnet_Membership WHERE aspnet_Membership.UserId = aspnet_Users.UserId
#

import base64
import binascii
import sys

with open(sys.argv[1]) as f:
    lines = f.readlines()
lines = [x.strip() for x in lines]

for line in lines:
    user,password_hash,salt = line.split("\t")
    password_hash = base64.b64decode(password_hash).hex()
    salt = base64.b64decode(salt).hex()
    print(f"{user}:$pbkdf2-hmac-sha1$1000$.{salt}.{password_hash}")
